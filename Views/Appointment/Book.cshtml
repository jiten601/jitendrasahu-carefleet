@model CareFleet.Models.Appointment
@{
    ViewData["Title"] = "Book Appointment";
    var userRole = Context.Session.GetString("UserRole");
    Layout = userRole == "Patient" ? "~/Views/Shared/_PatientLayout.cshtml" : "~/Views/Shared/_AdminLayout.cshtml";
    ViewBag.ActivePage = "Appointments";
    var doctors = ViewBag.Doctors as List<CareFleet.Models.Doctor>;
    var cancelUrl = userRole == "Patient" ? Url.Action("Appointments", "Patient") :
                    (userRole == "Admin" ? Url.Action("Appointments", "Admin") : Url.Action("Index"));
}

@section Styles {
    <link rel="stylesheet" href="~/css/admin-pages.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/book-appointment.css" asp-append-version="true" />
}

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const forSomeoneElse = document.getElementById('forSomeoneElse');
            if (forSomeoneElse) {
                forSomeoneElse.addEventListener('change', function() {
                    const infoBox = document.getElementById('otherPatientInfo');
                    if (this.checked) {
                        infoBox.style.display = 'block';
                    } else {
                        infoBox.style.display = 'none';
                    }
                });
            }
        });
    </script>
}

<div class="fade-in">
    <!-- Premium Header Card -->
    <div class="premium-header-card">
        <div class="header-card-content">
            <div class="header-info">
                <h1 class="fw-bold text-white mb-2">Schedule Appointment</h1>
            </div>
            <div class="header-actions">
                <a href="@cancelUrl" class="btn-premium-light text-decoration-none">
                    <i class="fas fa-arrow-left me-2"></i>Back to List
                </a>
            </div>
        </div>
        <div class="header-bg-pattern"></div>
    </div><br>

    <div class="form-container">
        <form asp-action="Book" method="post">
            @Html.AntiForgeryToken()

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" asp-for="DoctorName">Select Doctor <span class="required">*</span></label>
                    <select asp-for="DoctorName" class="form-control" required>
                        <option value="">Choose a Doctor</option>
                        @if (doctors != null)
                        {
                            @foreach (var doctor in doctors)
                            {
                                <option value="Dr. @doctor.FirstName @doctor.LastName">Dr. @doctor.FirstName @doctor.LastName (@doctor.Specialization)</option>
                            }
                        }
                    </select>
                    <span asp-validation-for="DoctorName" class="text-danger validation-error-small"></span>
                </div>

                <div class="form-group">
                    <label class="form-label" asp-for="AppointmentDate">Appointment Date <span class="required">*</span></label>
                    <input asp-for="AppointmentDate" type="date" class="form-control" required min="@DateTime.Now.ToString("yyyy-MM-dd")" />
                    <span asp-validation-for="AppointmentDate" class="text-danger validation-error-small"></span>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" asp-for="TimeSlot">Preferred Time <span class="required">*</span></label>
                    <select asp-for="TimeSlot" class="form-control" required>
                        <option value="">Select Time Slot</option>
                        <option>09:00 AM</option>
                        <option>10:00 AM</option>
                        <option>11:00 AM</option>
                        <option>01:00 PM</option>
                        <option>02:00 PM</option>
                        <option>03:00 PM</option>
                        <option>04:00 PM</option>
                    </select>
                    <span asp-validation-for="TimeSlot" class="text-danger validation-error-small"></span>
                </div>

                <div class="form-group">
                    <label class="form-label" asp-for="PatientName">Patient Name <small class="text-muted fw-normal">(Leave blank if booking for yourself)</small></label>
                    <input asp-for="PatientName" type="text" class="form-control" />
                    <span asp-validation-for="PatientName" class="text-danger validation-error-small"></span>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" asp-for="Reason">Reason for Visit <span class="required">*</span></label>
                <textarea asp-for="Reason" class="form-control" rows="3" required></textarea>
                <span asp-validation-for="Reason" class="text-danger validation-error-small"></span>
            </div>

            <!-- Booking for someone else toggle -->
            <div class="form-group toggle-container-premium">
                <div class="toggle-header">
                    <input asp-for="IsForSomeoneElse" type="checkbox" id="forSomeoneElse" class="toggle-checkbox">
                    <label for="forSomeoneElse" class="toggle-label">Booking for someone else?</label>
                </div>

                <div id="otherPatientInfo" class="nested-info-box">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Patient Full Name</label>
                            <input asp-for="OtherPatientName" class="form-control" />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Patient Date of Birth</label>
                            <input asp-for="OtherPatientDOB" type="date" class="form-control" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-actions-modern">
                <button type="submit" class="btn-primary-small btn-confirm-booking">
                    <i class="fas fa-check-circle"></i> Confirm Booking
                </button>
                <a href="@cancelUrl" class="btn-primary-small btn-cancel-booking">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>
