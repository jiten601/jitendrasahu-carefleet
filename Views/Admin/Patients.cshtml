@model IEnumerable<CareFleet.Models.Patient>
@{
    ViewData["Title"] = "Patients Management";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    ViewBag.ActivePage = "Patients";
    ViewBag.HeaderTitle = "Patients Management";
    ViewBag.HideHeader = true;
}

@section Scripts {
    <link rel="stylesheet" href="~/css/admin-pages.css" />
}

<div class="fade-in">
    <!-- Premium Header Card -->
    <div class="premium-header-card">
        <div class="header-card-content">
            <div class="header-info">
                <h3 class="fw-bold text-white mb-2">Patients Management</h3>
                <p class="text-white-50 mb-0">Review patient information and records.</p>
            </div>
            <div class="header-actions">
                <div style="position: relative;">
                    <input type="text" id="patientSearch" placeholder="Search patients..." class="form-control" style="padding-left: 35px; min-width: 250px; background: white;">
                    <i class="fas fa-search" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #718096; pointer-events: none;"></i>
                </div>
            </div>
        </div>
        <div class="header-bg-pattern"></div>
    </div>

<div class="table-container">
    <table class="data-table" id="patientsTable">
        <thead>
            <tr>
                <th>Patient Name</th>
                <th>Age / Gender</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Medical Hist.</th>
                <th>Joined</th>
                <th style="text-align: right;">Actions</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Any())
            {
                @foreach (var patient in Model)
                {
                    <tr>
                        <td>
                            <div style="font-weight: 600; color: #1B3C53;">@patient.FirstName @patient.LastName</div>
                            <div style="font-size: 11px; color: #718096; text-transform: uppercase; letter-spacing: 0.5px;">PAT-ID: @patient.Id.ToString("D5")</div>
                        </td>
                        <td>
                            <div>@(DateTime.Now.Year - (patient.DateOfBirth.Year)) Yrs</div>
                            <div style="font-size: 12px; color: #718096;">@patient.Gender</div>
                        </td>
                        <td>@patient.Email</td>
                        <td>@patient.PhoneNumber</td>
                        <td>
                            <div style="max-width: 200px; font-size: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="@patient.MedicalHistory">
                                @(string.IsNullOrEmpty(patient.MedicalHistory) ? "No history recorded" : patient.MedicalHistory)
                            </div>
                        </td>
                        <td>@patient.CreatedAt.ToString("MMM dd, yyyy")</td>
                        <td>
                            <div class="action-buttons" style="justify-content: flex-end;">
                                <a href="@Url.Action("Edit", "Patient", new { id = patient.Id })" class="btn-icon edit" title="Edit Patient">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <form asp-action="Delete" asp-controller="Patient" method="post" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this patient?');">
                                    <input type="hidden" name="id" value="@patient.Id" />
                                    <button type="submit" class="btn-icon delete" title="Delete Patient">
                                        <i class="fas fa-user-minus"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="7" style="text-align: center; padding: 40px; color: #718096;">
                        <i class="fas fa-users-slash" style="font-size: 48px; margin-bottom: 15px; display: block; opacity: 0.3;"></i>
                        No patients registered in the system.
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
</div>


<script>
    document.getElementById('patientSearch').addEventListener('keyup', function() {
        const value = this.value.toLowerCase();
        const rows = document.querySelectorAll('#patientsTable tbody tr');
        
        rows.forEach(row => {
            if (row.cells.length > 1) { // Skip empty state row
                const text = row.textContent.toLowerCase();
                row.style.display = text.indexOf(value) > -1 ? '' : 'none';
            }
        });
    });
</script>
