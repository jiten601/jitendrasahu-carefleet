@model CareFleet.Models.Patient
@{
    ViewData["Title"] = "Patient Profile";
    Layout = "~/Views/Shared/_PatientLayout.cshtml";
    
    var patient = Model ?? new CareFleet.Models.Patient { 
        Id = 0,
        FirstName = ViewBag.FirstName?.ToString() ?? "Patient", 
        LastName = ViewBag.LastName?.ToString() ?? "User", 
        Email = ViewBag.UserEmail?.ToString() ?? "patient@carefleet.com",
        CreatedAt = DateTime.Now.AddYears(-1)
    };
    
    var initials = ((patient.FirstName?.Length > 0 ? patient.FirstName.Substring(0, 1) : "P") + 
                   (patient.LastName?.Length > 0 ? patient.LastName.Substring(0, 1) : "A")).ToUpper();
    
    var memberSince = patient.CreatedAt.ToString("MMMM yyyy");
}

<div class="profile-page">
    <!-- Hero Section -->
    <div class="profile-hero">
        <div class="hero-background"></div>
        <div class="container-fluid px-5">
            <div class="row align-items-end">
                <div class="col-lg-8">
                    <div class="d-flex align-items-end gap-4">
                        <div class="profile-avatar-large">
                            <div class="avatar-circle">@initials</div>
                            <div class="verified-badge">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                        <div class="hero-info pb-3">
                            <h1 class="doctor-name mb-2">@patient.FirstName @patient.LastName</h1>
                            <p class="specialization mb-3">
                                <i class="fas fa-id-card me-2"></i>Patient ID: #PAT-@patient.Id.ToString("D4")
                            </p>
                            <div class="d-flex gap-3 flex-wrap">
                                <span class="info-badge">
                                    <i class="fas fa-calendar-check me-2"></i>Member since @memberSince
                                </span>
                                <span class="info-badge">
                                    <i class="fas fa-tint me-2"></i>Blood Group: @(string.IsNullOrEmpty(patient.BloodGroup) ? "Not Set" : patient.BloodGroup)
                                </span>
                                <span class="info-badge">
                                    <i class="fas fa-venus-mars me-2"></i>@patient.Gender
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 text-lg-end pb-3">
                    <a href="@Url.Action("Settings", "Patient")" class="btn btn-edit-profile">
                        <i class="fas fa-edit me-2"></i>Edit Profile
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container-fluid px-5 py-5">
        <div class="row g-4">
            <!-- Left Column -->
            <div class="col-lg-8">
                <!-- Medical Overview Section -->
                <div class="profile-card mb-4">
                    <div class="card-header-profile">
                        <h3 class="section-title">
                            <i class="fas fa-file-medical me-3"></i>Medical Overview
                        </h3>
                    </div>
                    <div class="card-body-profile">
                        <h5 class="fw-bold mb-3">Medical History</h5>
                        <p class="about-text">
                            @(string.IsNullOrEmpty(patient.MedicalHistory) ? "No medical history recorded yet. Please update your profile to include important health information." : patient.MedicalHistory)
                        </p>
                    </div>
                </div>

                <!-- Health Information Section -->
                <div class="profile-card mb-4">
                    <div class="card-header-profile">
                        <h3 class="section-title">
                            <i class="fas fa-heartbeat me-3"></i>Health Information
                        </h3>
                    </div>
                    <div class="card-body-profile">
                        <div class="expertise-tags">
                            <span class="expertise-tag">Blood Group: @(string.IsNullOrEmpty(patient.BloodGroup) ? "N/A" : patient.BloodGroup)</span>
                            <span class="expertise-tag">@patient.Gender</span>
                            <span class="expertise-tag">DOB: @patient.DateOfBirth.ToString("MMM dd, yyyy")</span>
                            <span class="expertise-tag">Status: Active</span>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity/Timeline -->
                <div class="profile-card mb-4">
                    <div class="card-header-profile">
                        <h3 class="section-title">
                            <i class="fas fa-clock me-3"></i>Patient Timeline
                        </h3>
                    </div>
                    <div class="card-body-profile">
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <h4 class="timeline-title">Account Created</h4>
                                    <p class="timeline-subtitle">CareFleet Registration</p>
                                    <p class="timeline-date">@patient.CreatedAt.ToString("MMM dd, yyyy")</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <h4 class="timeline-title">Profile Initialized</h4>
                                    <p class="timeline-subtitle">Personal information added</p>
                                    <p class="timeline-date">@patient.CreatedAt.AddMinutes(5).ToString("MMM dd, yyyy")</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="col-lg-4">
                <!-- Contact Information -->
                <div class="profile-card mb-4 sticky-card">
                    <div class="card-header-profile">
                        <h3 class="section-title">
                            <i class="fas fa-address-card me-3"></i>Contact Information
                        </h3>
                    </div>
                    <div class="card-body-profile">
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <div class="contact-details">
                                <p class="contact-label">Email</p>
                                <p class="contact-value">@patient.Email</p>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div class="contact-details">
                                <p class="contact-label">Phone</p>
                                <p class="contact-value">@(string.IsNullOrEmpty(patient.PhoneNumber) ? "Not Provided" : patient.PhoneNumber)</p>
                            </div>
                        </div>
                        <div class="contact-item mb-0">
                            <div class="contact-icon">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <div class="contact-details">
                                <p class="contact-label">Address</p>
                                <p class="contact-value">@(string.IsNullOrEmpty(patient.Address) ? "Not Provided" : patient.Address)</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions / Support -->
                <div class="profile-card mb-4">
                    <div class="card-header-profile">
                        <h3 class="section-title">
                            <i class="fas fa-hand-holding-medical me-3"></i>Care & Support
                        </h3>
                    </div>
                    <div class="card-body-profile">
                        <div class="availability-item">
                            <span class="day-label">Last Checkup</span>
                            <span class="time-label">None</span>
                        </div>
                        <div class="availability-item">
                            <span class="day-label">Upcoming</span>
                            <span class="time-label text-primary">None scheduled</span>
                        </div>
                        <hr class="my-4">
                        <a href="@Url.Action("Appointments", "Patient")" class="btn btn-book-appointment w-100">
                            <i class="fas fa-calendar-plus me-2"></i>Book Appointment
                        </a>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="profile-card">
                    <div class="card-header-profile">
                        <h3 class="section-title">
                            <i class="fas fa-chart-bar me-3"></i>My Activity
                        </h3>
                    </div>
                    <div class="card-body-profile p-0">
                        <div class="stats-grid-modern">
                            <a href="@Url.Action("Appointments", "Patient")" class="stat-grid-item">
                                <div class="stat-num-box">
                                    <span class="stat-number">@ViewBag.AppointmentCount</span>
                                </div>
                                <div class="stat-label">Appointments</div>
                            </a>
                            <a href="@Url.Action("MedicalRecords", "Patient")" class="stat-grid-item border-start">
                                <div class="stat-num-box">
                                    <span class="stat-number">@ViewBag.RecordCount</span>
                                </div>
                                <div class="stat-label">Medical Records</div>
                            </a>
                        </div>
                        <div class="stat-full-width border-top">
                            <div class="d-flex align-items-center justify-content-center gap-3">
                                <div class="stat-num-badge">
                                    @(DateTime.Now.Year - patient.CreatedAt.Year + 1)@(DateTime.Now.Year - patient.CreatedAt.Year + 1 == 1 ? "st" : (DateTime.Now.Year - patient.CreatedAt.Year + 1 == 2 ? "nd" : "th"))
                                </div>
                                <div class="stat-label mb-0">Year with CareFleet</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/patient-profile.css" asp-append-version="true" />
}
